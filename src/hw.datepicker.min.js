var DatePicker=function(a){if(void 0===a.input)throw new Exception("Input field is not specified.");var b=$(a.input);if(!b.length)throw new Exception("Specified input field does not exists.");var c;if(void 0===a.container)c=b.parent();else{if(!$(a.container).length)throw new Exception("Specified container does not exist.");c=$(a.container)}if(void 0===a.trigger)throw new Exception("Trigger is not defined.");var d=$(a.trigger);if(!d.length)throw new Exception("Specified trigger does not exist.");var e=a.currentDate||new Date;if(e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),void 0!==a.minDate){var f=new Date(a.minDate);if(isNaN(f.getTime()))throw new Exception("Min date is not valid");f.setHours(0),f.setMinutes(0),f.setSeconds(0),f.setMilliseconds(0)}if(void 0!==a.maxDate){var g=new Date(a.maxDate);if(isNaN(g.getTime()))throw new Exception("Max date is not valid");g.setHours(0),g.setMinutes(0),g.setSeconds(0),g.setMilliseconds(0)}if(void 0!==g&&void 0!==f&&f>g)throw new Exception("Min date is greater then max date.");return{currentPicker:null,input:b,trigger:d,currentDate:e,selectedDate:null,activeDate:new Date(e),maxDate:g||null,minDate:f||null,startWithMonday:a.startWithMonday||!1,dateFormat:a.dateFormat||"dd.mm.yyyy",events:$.extend({onSelect:null,onMonthChange:null,onOpen:null,onClose:null},a.events||{}),i18n:$.extend({prevMonth:"Previous month",nextMonth:"Next month",monthName:["January","February","March","April","May","June","July","August","September","October","November","December"],weekNameFull:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekNameShort:["Mo","Tu","We","Th","Fr","Sa","Su"]},a.i18n||{}),init:function(){var a=this;this.trigger.click(function(b){(null==a.currentPicker||a.currentPicker.hasClass("hw_closed"))&&(b.stopPropagation(),a.open())});var b=this.strToDate(this.input.val());null==b||isNaN(b.getTime())||b==this.selectedDate||this.changeDate(b),this.input.keyup(function(){var b=a.strToDate($(this).val());null==b||isNaN(b.getTime())||(null==a.minDate||a.minDate<=b)&&(null==a.maxDate||a.maxDate>=b)&&a.changeDate(b)}),$(window).resize(function(b){null!=a.currentPicker&&a.adjustPosition()})},changeDate:function(a){this.selectedDate=a,this.activeDate=new Date(a),this.currentPicker&&this.monthChange(this.activeDate)},render:function(){return this.currentPicker=$('<div class="hw_datepicker hw_closed" aria-hidden="true" tabindex="0" role="application" />').click(function(a){a.stopPropagation()}),this.adjustPosition(),this.renderMonthNavigation(this.activeDate).appendTo(this.currentPicker),this.renderBody().appendTo(this.currentPicker),this.currentPicker},adjustPosition:function(){var a=this.input.offset();this.currentPicker.css({left:a.left,top:a.top+this.input.outerHeight()})},renderMonthNavigation:function(a){var a=new Date(a),b=this.getPrevMonthDate(a),c=this.getNextMonthDate(a),d=this.renderMonthNavBtn(this.i18n.prevMonth,b.getTime(),"hw_monthLeft").trigger("redraw",this.minDate&&b<=this.minDate&&b<=this.selectedDate),e=this.renderMonthNavBtn(this.i18n.nextMonth,c.getTime(),"hw_monthRight").trigger("redraw",this.maxDate&&c>=this.maxDate&&c>=this.selectedDate);return $('<div class="hw_monthContainer" />').append(d).append($('<div class="hw_currentMonth" />').html(this.i18n.monthName[a.getMonth()]+" "+a.getFullYear())).append(e)},monthBtnClick:function(a){var b=new Date(parseInt($(a.currentTarget).attr("data-date")));this.events.onMonthChange&&this.events.onMonthChange.call(this,b,a),this.monthChange(b)},renderMonthNavBtn:function(a,b,c){var d=this;return $("<button />").attr({type:"button",class:"hw_monthButton "+c,"aria-label":a,"data-date":b}).on("redraw",function(a,b){b?$(this).addClass("hw_unavailable").attr({"aria-disabled":"true",tabindex:"-1"}).off("click"):$(this).removeClass("hw_unavailable").attr({"aria-disabled":"false",tabindex:"0"}).off("click").on("click",$.proxy(d.monthBtnClick,d))})},renderBody:function(){return $('<div class="hw_pickerBody" />').append(this.renderBodyHeader()).append(this.renderWeeks(this.activeDate))},renderBodyHeader:function(){var a=$('<div class="hw_pickerBodyHeader" />'),b=this;return this.startWithMonday||(this.i18n.weekNameFull.unshift(this.i18n.weekNameFull.pop()),this.i18n.weekNameShort.unshift(this.i18n.weekNameShort.pop())),$.each(b.i18n.weekNameShort,function(c,d){$('<div title="'+b.i18n.weekNameFull[c]+'">'+d+"</div>").appendTo(a)}),a},renderWeeks:function(a){var c,b=new Date(a),d=[],e=0,f=this.getLastDate(b),g=b.getMonth();for(b.setDate(1),b.setDate(b.getDate()+(this.startWithMonday?-6:0)-b.getDay());b<=f;){c=this.renderRow(e);for(var h=0;h<7;h++)c.append(this.renderCell(b,g)),b.setDate(b.getDate()+1);e++,d.push(c)}return d},renderRow:function(a){return $('<div class="hw_week" data-week="'+a+'" />')},renderCell:function(a,b){var c=this,d=b!=a.getMonth(),e=[],f=!1;d&&e.push("hw_inactive"),a.getTime()===this.currentDate.getTime()&&e.push("hw_currentDate"),(this.maxDate&&this.maxDate<a||this.minDate&&this.minDate>a)&&(e.push("hw_unavailable"),f=!0),null!=this.selectedDate&&a.getTime()===this.selectedDate.getTime()&&e.push("hw_selectedDate");var g=$("<button />").attr({"aria-label":this.getFullDate(a),"data-dayindex":a.getDay(),"data-date":a.getTime(),"aria-hidden":d||f?"true":"false",class:e.join(" "),tabindex:d||f?"-1":"0"}).text(this.addFrontZeros(a.getDate()));return d||f||g.click(function(a){c.selectDate(a)}).hover(function(){c.currentPicker.find(".hw_activeDay").removeClass("hw_activeDay"),$(this).addClass("hw_activeDay")},function(){$(this).removeClass("hw_activeDay")}),$('<div class="hw_day" />').append(g)},addFrontZeros:function(a){return(a<10?"0":"")+a},getLastDate:function(a){var b=new Date(a);return b.setMonth(b.getMonth()+1),b.setDate(0),b.setHours(0),b.setMinutes(0),b.setSeconds(0),b},getNextMonthDate:function(a){var b=new Date(a);return b.setDate(1),b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMonth(b.getMonth()+1),b},getPrevMonthDate:function(a){var b=new Date(a);return b.setDate(0),b.setHours(0),b.setMinutes(0),b.setSeconds(0),b},getFullDate:function(a){return this.i18n.monthName[a.getMonth()]+" "+a.getDate()+" "+a.getFullYear()},selectDate:function(a){this.events.onSelect&&this.events.onSelect.call(this,a);var b=$(a.currentTarget),c=new Date;c.setTime(b.attr("data-date")),this.input.val(this.getFormatedDate(c)).attr("aria-label",b.attr("aria-label")),this.selectedDate=c,this.currentPicker.find(".hw_selectedDate").removeClass("hw_selectedDate"),b.addClass("hw_selectedDate"),this.close(a)},monthChange:function(a){this.currentPicker.find(".hw_week").remove(),this.currentPicker.find(".hw_pickerBody").append(this.renderWeeks(a)),this.currentPicker.find(".hw_currentMonth").html(this.i18n.monthName[a.getMonth()]+" "+a.getFullYear());var b=this.getPrevMonthDate(a),c=this.getNextMonthDate(a);this.currentPicker.find(".hw_monthLeft").trigger("redraw",this.minDate&&b<=this.minDate&&b<=this.selectedDate).attr("data-date",b.getTime()),this.currentPicker.find(".hw_monthRight").trigger("redraw",this.maxDate&&c>=this.maxDate&&c>=this.selectedDate).attr("data-date",c.getTime())},open:function(){this.currentPicker||$(c).append(this.render()),$("body").click($.proxy(this.close,this)),this.currentPicker.removeClass("hw_closed").removeAttr("aria-hidden"),this.events.onOpen&&this.events.onOpen.call(this)},close:function(a){this.events.onClose&&this.events.onClose.call(this,a),this.currentPicker.addClass("hw_closed").attr("aria-hidden","true"),$("body").off("click",this.close)},getFormatedDate:function(a){var b=a.getDate(),c=a.getMonth()+1;return this.dateFormat.replace("dd",this.addFrontZeros(b)).replace("d",b).replace("mm",this.addFrontZeros(c)).replace("m",c).replace("yyyy",a.getFullYear())},strToDate:function(a){var b=new RegExp("^"+this.dateFormat.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace("yyyy","([0-9]{4})").replace("mm","([0-1]{1}[0-9]{1})").replace("m","([0-9]{1,2})").replace("dd","([0-3]{1}[0-9]{1})").replace("d","([0-9]{1,2})")+"$",f),c=b.exec(a);if(null!=c){var d=[];d[this.dateFormat.indexOf("y")]="setFullYear",d[this.dateFormat.indexOf("m")]="setMonth",d[this.dateFormat.indexOf("d")]="setDate";for(var e=new Date(2e3,0,1,0,0,0,0),f=1,g=0;g<d.length;g++){var h=d[g];if(h){var i=parseInt(c[f]);"setMonth"==h&&i--,e[h](i),f++}}return e}return null}}};