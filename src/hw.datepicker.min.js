var DatePicker=function(a){function b(a){a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)}if(void 0===a.input)throw new Exception("Input field is not specified.");var c=$(a.input);if(!c.length)throw new Exception("Specified input field does not exist.");var d;if(void 0===a.container)d=$("body");else if(d=$(a.container),!d.length)throw new Exception("Specified container does not exist.");if(void 0===a.trigger)throw new Exception("Trigger is not defined.");var e=$(a.trigger);if(!e.length)throw new Exception("Specified trigger does not exist.");var f=new Date;if(void 0!==a.currentDate){var f=new Date(a.currentDate);if(isNaN(f.getTime()))throw new Exception("Current date is not valid.")}if(b(f),void 0!==a.minDate){var g=new Date(a.minDate);if(isNaN(g.getTime()))throw new Exception("Min date is not valid.");b(g)}if(void 0!==a.maxDate){var h=new Date(a.maxDate);if(isNaN(h.getTime()))throw new Exception("Max date is not valid");b(h)}if(void 0!==h&&void 0!==g&&g>h)throw new Exception("Min date is greater then max date.");return{currentPicker:null,input:c,trigger:e,currentDate:f,selectedDate:null,activeDate:new Date(f),maxDate:h||null,minDate:g||null,startWithMonday:a.startWithMonday||!1,dateFormat:a.dateFormat||"dd.mm.yyyy",events:$.extend({onSelect:null,onMonthChange:null,onOpen:null,onClose:null,onDateFocus:null},a.events||{}),i18n:$.extend({prevMonth:"Previous month",nextMonth:"Next month",monthName:["January","February","March","April","May","June","July","August","September","October","November","December"],weekNameFull:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],weekNameShort:["Mo","Tu","We","Th","Fr","Sa","Su"],currentDate:"Current date",selectedDate:"Selected date",currentMonth:"Current month",lastAvailableDate:"Last available date",firstAvailableDate:"First available date",notAvailable:"Date is not available",description:"datepicker"},a.i18n||{}),init:function(){var a=this;this.trigger.click(function(b){(null==a.currentPicker||a.currentPicker.hasClass("hw_closed"))&&(b.stopPropagation(),a.open())});var b=this.strToDate(this.input.val());null==b||isNaN(b.getTime())||b==this.selectedDate||this.changeDate(b),this.input.keyup(function(){var b=a.strToDate($(this).val());null==b||isNaN(b.getTime())||(null==a.minDate||a.minDate<=b)&&(null==a.maxDate||a.maxDate>=b)&&a.changeDate(b)}),$(window).resize(function(){null!=a.currentPicker&&a.adjustPosition()})},changeDate:function(a){this.selectedDate=a,this.activeDate=new Date(a),this.currentPicker&&this.monthChange(this.activeDate)},render:function(){return this.currentPicker=$("<div />").attr({class:"hw_datepicker hw_closed","aria-hidden":"true",tabindex:"0",role:"application","aria-label":this.i18n.description}).click(function(a){a.stopPropagation()}).keydown($.proxy(this.keyboardNavigation,this)),this.adjustPosition(),this.renderMonthNavigation(this.activeDate).appendTo(this.currentPicker),this.renderBody().appendTo(this.currentPicker),this.currentPicker},keyboardNavigation:function(a){var b=a.which||a.keyCode;switch(b){case 27:this.close(a);break;case 33:a.preventDefault(),a.stopPropagation();var c=new Date(this.activeDate);c.setMonth(c.getMonth()-1),this.activeDate.getMonth()-c.getMonth()==0&&c.setDate(0),this.focusDate(c,!0);break;case 34:a.preventDefault(),a.stopPropagation();var c=new Date(this.activeDate);c.setMonth(c.getMonth()+1),c.getMonth()-this.activeDate.getMonth()>1&&c.setDate(0),this.focusDate(c,!0);break;case 35:a.preventDefault(),a.stopPropagation();var c=this.getLastDate(this.activeDate);this.focusDate(c,!0);break;case 36:a.preventDefault(),a.stopPropagation();var c=new Date(this.activeDate);c.setDate(1),this.focusDate(c,!0);break;case 37:a.preventDefault(),a.stopPropagation(),this.focusDate(1,!1);break;case 38:a.preventDefault(),a.stopPropagation(),this.focusDate(7,!1);break;case 39:a.preventDefault(),a.stopPropagation(),this.focusDate(1,!0);break;case 40:a.preventDefault(),a.stopPropagation(),this.focusDate(7,!0);break;case 9:$(a.target).hasClass("hw_lastActive")&&(a.preventDefault(),a.stopPropagation(),this.close(),this.trigger.focus())}},getActive:function(){return this.activeDate||(this.activeDate=this.currentPicker.find(".hw_selectedDate, .hw_currentDate, .hw_default").first()),this.activeDate},focusDate:function(a,b){if("object"!=typeof a){var c=new Date(this.activeDate);c.setDate(c.getDate()+(b?1:-1)*a)}else var c=a;return this.maxDate&&c>this.maxDate?void this.focusDate(this.maxDate):this.minDate&&c<this.minDate?void this.focusDate(this.minDate):(this.activeDate.getMonth()!=c.getMonth()&&this.monthChange(c),void this.currentPicker.find("button[data-date="+c.getTime()+"]").focus())},adjustPosition:function(){var a=this.input.offset();this.currentPicker.css({left:a.left,top:a.top+this.input.outerHeight()})},renderMonthNavigation:function(a){var a=new Date(a),b=this.getPrevMonthDate(a),c=this.getNextMonthDate(a),d=this.renderMonthNavBtn(this.i18n.prevMonth,b,"hw_monthLeft").trigger("redraw",this.minDate&&b<=this.minDate&&b<=this.selectedDate),e=this.renderMonthNavBtn(this.i18n.nextMonth,c,"hw_monthRight").trigger("redraw",this.maxDate&&c>=this.maxDate&&c>=this.selectedDate),f=this.displayMonthYear(a);return $('<div class="hw_monthContainer" />').append(d).append($('<div class="hw_currentMonth" />').attr({tabindex:"0","aria-label":f,title:this.i18n.currentMonth}).html(f)).append(e)},monthBtnClick:function(a){var b=new Date(parseInt($(a.currentTarget).attr("data-date")));this.events.onMonthChange&&this.events.onMonthChange.call(this,b,a),this.monthChange(b)},renderMonthNavBtn:function(a,b,c){var d=this;return $("<button />").attr({type:"button",class:"hw_monthButton "+c,"aria-label":this.displayMonthYear(b),title:a,"data-date":b.getTime()}).on("redraw",function(a,b){b?$(this).addClass("hw_unavailable").attr({"aria-disabled":"true",tabindex:"-1"}).off("click"):$(this).removeClass("hw_unavailable").attr({"aria-disabled":"false",tabindex:"0"}).off("click").on("click",$.proxy(d.monthBtnClick,d))})},displayMonthYear:function(a){return this.i18n.monthName[a.getMonth()]+" "+a.getFullYear()},renderBody:function(){return $('<div class="hw_pickerBody" />').append(this.renderBodyHeader()).append(this.renderWeeks(this.activeDate))},renderBodyHeader:function(){var a=$('<div class="hw_pickerBodyHeader" role="rowheader" />'),b=this;return this.startWithMonday||(this.i18n.weekNameFull.unshift(this.i18n.weekNameFull.pop()),this.i18n.weekNameShort.unshift(this.i18n.weekNameShort.pop())),$.each(b.i18n.weekNameShort,function(c,d){$('<div title="'+b.i18n.weekNameFull[c]+'" role="columnheader">'+d+"</div>").appendTo(a)}),a},renderWeeks:function(a){var c,i,j,b=new Date(a),d=[],e=0,f=this.getLastDate(b),g=b.getMonth(),h=null;for(b.setDate(1),b.setDate(b.getDate()+(this.startWithMonday?-6:0)-b.getDay());b<=f;){c=this.renderRow(e);for(var k=0;k<7;k++)i=this.renderCell(b,g),c.append(i),j=i.children("button"),j.hasClass("hw_default")&&(h=j),b.setDate(b.getDate()+1);e++,d.push(c)}return h&&h.addClass("hw_lastActive"),d},renderRow:function(a){return $('<div class="hw_week" data-week="'+a+'" />')},renderCell:function(a,b){var c=!1,d=[],e=$("<button />").attr({"aria-label":this.getFullDate(a),"data-dayindex":a.getDay(),"data-date":a.getTime(),tabindex:"0"}).text(this.addFrontZeros(a.getDate()));if(b!=a.getMonth()?(e.addClass("hw_inactive").attr({"aria-hidden":"true",tabindex:"-1"}),c=!0):(this.maxDate&&this.maxDate<a||this.minDate&&this.minDate>a)&&(e.addClass("hw_unavailable").attr({"aria-hidden":"true",tabindex:"-1"}),d[0]=this.i18n.notAvailable,c=!0),a.getTime()===this.currentDate.getTime()&&(e.addClass("hw_currentDate"),d[0]=this.i18n.currentDate),null!=this.selectedDate&&a.getTime()===this.selectedDate.getTime()&&(e.addClass("hw_selectedDate"),d[0]=this.i18n.selectedDate),this.minDate&&this.minDate.getTime()==a.getTime()&&d.push(this.i18n.firstAvailableDate),this.maxDate&&this.maxDate.getTime()==a.getTime()&&d.push(this.i18n.lastAvailableDate),d.length&&e.attr("title",d.join(", ")),c)e.prop("disabled");else{var f=this;e.addClass("hw_default").click(function(a){f.selectDate(a)}).hover(function(a){$(this).focus()},function(a){$(this).blur()}).focus(function(a){var b=new Date;b.setTime($(this).attr("data-date")),f.events.onDateFocus&&f.events.onDateFocus(a,b),f.currentPicker.find(".hw_activeDay").removeClass("hw_activeDay"),f.activeDate=b,$(this).addClass("hw_activeDay")}).blur(function(a){$(this).removeClass("hw_activeDay")})}return $('<div class="hw_day" />').append(e)},addFrontZeros:function(a){return(a<10?"0":"")+a},getLastDate:function(a){var c=new Date(a);return c.setDate(1),c.setMonth(c.getMonth()+1),c.setDate(0),b(c),c},getNextMonthDate:function(a){var c=new Date(a);return c.setDate(1),b(c),c.setMonth(c.getMonth()+1),c},getPrevMonthDate:function(a){var c=new Date(a);return c.setDate(0),b(c),c},getFullDate:function(a){return this.i18n.monthName[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()},selectDate:function(a){this.events.onSelect&&this.events.onSelect.call(this,a);var b=$(a.currentTarget),c=new Date;c.setTime(b.attr("data-date")),this.input.val(this.getFormatedDate(c)).attr("aria-label",b.attr("aria-label")),this.selectedDate=c,this.currentPicker.find(".hw_selectedDate").removeClass("hw_selectedDate"),b.addClass("hw_selectedDate"),this.close(a)},monthChange:function(a){this.currentPicker.find(".hw_week").remove(),this.currentPicker.find(".hw_pickerBody").append(this.renderWeeks(a));var b=this.displayMonthYear(a);this.currentPicker.find(".hw_currentMonth").attr("aria-label",b).html(b);var c=this.getPrevMonthDate(a),d=this.getNextMonthDate(a);this.currentPicker.find(".hw_monthLeft").trigger("redraw",this.minDate&&c<=this.minDate&&c<=this.selectedDate).attr({"data-date":c.getTime(),"aria-label":this.displayMonthYear(c)}),this.currentPicker.find(".hw_monthRight").trigger("redraw",this.maxDate&&d>=this.maxDate&&d>=this.selectedDate).attr({"data-date":d.getTime(),"aria-label":this.displayMonthYear(d)}),this.activeDate=a},open:function(){this.events.onOpen&&this.events.onOpen.call(this),this.currentPicker||$(d).append(this.render()),$("body").click($.proxy(this.close,this)),this.currentPicker.removeClass("hw_closed").removeAttr("aria-hidden").focus(),this.getActive()},close:function(a){this.events.onClose&&this.events.onClose.call(this,a),this.currentPicker.addClass("hw_closed").attr("aria-hidden","true"),$("body").off("click",this.close),this.input.focus()},getFormatedDate:function(a){var b=a.getDate(),c=a.getMonth()+1;return this.dateFormat.replace("dd",this.addFrontZeros(b)).replace("d",b).replace("mm",this.addFrontZeros(c)).replace("m",c).replace("yyyy",a.getFullYear())},strToDate:function(a){var b=new RegExp("^"+this.dateFormat.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace("yyyy","([0-9]{4})").replace("mm","([0-1]{1}[0-9]{1})").replace("m","([0-9]{1,2})").replace("dd","([0-3]{1}[0-9]{1})").replace("d","([0-9]{1,2})")+"$",f),c=b.exec(a);if(null!=c){var d=[];d[this.dateFormat.indexOf("y")]="setFullYear",d[this.dateFormat.indexOf("m")]="setMonth",d[this.dateFormat.indexOf("d")]="setDate";for(var e=new Date(2e3,0,1,0,0,0,0),f=1,g=0;g<d.length;g++){var h=d[g];if(h){var i=parseInt(c[f]);"setMonth"==h&&i--,e[h](i),f++}}return e}return null}}};